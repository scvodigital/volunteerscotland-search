{{#if keywords ~}}
{{>queries_query_string
  querystring=keywords
  fields=(split "text_bag_boost^5,text_bag" ",")
}},
{{/if ~}}
{{#ifAny location la ~}}
{
  "bool": {
    "should": [
      {{#ifAll location lat lng distance ~}}
      {
        "geo_distance": {
          "distance": "{{default distance "10"}}mi",
          "geo_coords": {
            "lat": {{lat}},
            "lon": {{lng}}
          }
        }
      },
      {{/ifAll ~}}
      {{#if la ~}}
      {{>queries_term field="advertised_areas" term=la}},
      {{/if ~}}
      {{>queries_do_nothing}}
    ],
    "minimum_should_match": {{#if distance}}2{{else}}{{#if advertised_areas}}2{{else}}1{{/if}}{{/if}}
  }
},
{{/ifAny ~}}
{{#ifAny home_based suitable_for_groups suitable_for_one_off board_trustee ~}}
{
  "bool": {
    "should": [
      {{#if home_based ~}}
      {{>queries_boolean field="home_based"}},
      {{/if ~}}
      {{#if suitable_for_groups ~}}
      {{>queries_boolean field="suitable_for_groups"}},
      {{/if ~}}
      {{#if suitable_for_one_off ~}}
      {{>queries_boolean field="suitable_for_one_off"}},
      {{/if ~}}
      {{#if board_trustee ~}}
      {{>queries_boolean field="board_trustee"}},
      {{/if ~}}
      {{>queries_do_nothing}}
    ],
    "minimum_should_match": 2
  }
},
{{/ifAny ~}}
{{#if work_types ~}}
{{>queries_terms field="work_type_slugs" terms=work_types}},
{{/if ~}}
{{#if client_groups ~}}
{{>queries_terms field="client_group_slugs" terms=client_groups}},
{{/if ~}}
{{#if services ~}}
{{>queries_terms field="volunteersearch_support_option_slugs" terms=services}},
{{/if ~}}
{{#if age_groups ~}}
{{>queries_terms field="volunteersearch_age_group_slugs" terms=age_groups}},
{{/if ~}}
{{#if availability ~}}
{{>queries_terms field="availability_slugs" terms=availability}},
{{/if ~}}
{{>queries_do_nothing}}
