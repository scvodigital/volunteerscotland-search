{{#*inline "term_filter"}}
<h3 class="mdc-drawer__content-heading cursor-pointer noselect mdc-drawer--occasional-ie11" data-checkbox-collapse-target="#{{../instance_id}}-{{type}}-collapse" role="button" aria-pressed="false" aria-label="Show {{getProperty @root.context.metaData.termTypeLabels (concat type ".plural")}}" tabindex="0">
  {{#compare type "===" "regions" ~}}
  Regions
  {{else}}
  {{#compare type "===" "types" ~}}
  Types
  {{else}}
  {{getProperty @root.context.metaData.termTypeLabels (concat type ".plural")}}
  {{/compare ~}}
  {{/compare ~}}
  <span class="mdc-icon-toggle pull-right">
    <i class="far fa-chevron-down" aria-hidden="true"></i>
  </span>
</h3>
<div class="mdc-drawer--occasional-ie11 checkbox-toggle-display-checked" id="{{../instance_id}}-{{type}}-collapse" >
  {{#compare type "===" "regions" ~}}
    {{#if (any @root.data.opportunitySupplimentary.types.aggregations.countries.buckets) ~}}
      {{#each @root.data.opportunitySupplimentary.types.aggregations.countries.buckets ~}}
        {{#if key ~}}
          {{!-- #compare (length @root.data.opportunitySupplimentary.types.aggregations.countries.buckets) ">=" 1 ~}}
            <h3 class="mdc-typography--headline7">{{{key}}}</h3>
          {{/compare ~ --}}
        {{/if ~}}
        {{#compare key "Scotland" ~}}
          {{#each this.regions_slugs.buckets ~}}
            {{#if key ~}}
              {{> term_checkbox slug=key field="regions" selected=@root.request.params.query.regions instance_id=../../../instance_id value=(lookup ../this.regions.buckets @index)}}
            {{/if ~}}
          {{/each ~}}
        {{else}}
          <div class="mdc-typography--headline7 checkbox-collapse-element">Other</div>
          {{#each this.regions_slugs.buckets ~}}
            {{#if key ~}}
              {{> term_checkbox slug=key field="regions" selected=@root.request.params.query.regions instance_id=../../../instance_id value=(lookup ../this.regions.buckets @index)}}
            {{/if ~}}
          {{/each ~}}
        {{/compare ~}}

      {{/each ~}}
      {{#ifAny (length @root.data.opportunitySupplimentary.types.aggregations.home_based.buckets) (length @root.data.opportunitySupplimentary.types.aggregations.various_locations.buckets) ~}}
        {{!-- #compare (length @root.data.opportunitySupplimentary.types.aggregations.countries.buckets) ">=" 1 ~}}
          <h3 class="mdc-typography--headline7">Other</h3>
        {{/compare ~ --}}
        {{#compare (length @root.data.opportunitySupplimentary.types.aggregations.home_based.buckets) ">=" 1 ~}}
          {{> term_checkbox slug="true" field="home_based" selected=@root.request.params.query.home_based instance_id=../instance_id value="Home-based"}}
        {{/compare ~}}
        {{#compare (length @root.data.opportunitySupplimentary.types.aggregations.various_locations.buckets) ">=" 1 ~}}
          {{> term_checkbox slug="true" field="various_locations" selected=@root.request.params.query.various_locations instance_id=../instance_id value="Various locations"}}
        {{/compare ~}}
      {{/ifAny ~}}
    {{/if ~}}
  {{else}}
    {{#compare type "===" "types" ~}}
      {{> term_checkbox slug="true" field="home_based" selected=@root.request.params.query.home_based instance_id=../../instance_id value="Home-based volunteering"}}
      {{> term_checkbox slug="true" field="suitable_for_groups" selected=@root.request.params.query.suitable_for_groups instance_id=../../instance_id value="Suitable for groups"}}
      {{> term_checkbox slug="true" field="suitable_for_one_off" selected=@root.request.params.query.suitable_for_one_off instance_id=../../instance_id value="One-off volunteering"}}
      {{> term_checkbox slug="true" field="board_trustee" selected=@root.request.params.query.board_trustee instance_id=../../instance_id value="Board/trustee role"}}
    {{else}}
      {{#each (getProperty @root.data.opportunitySupplimentary.types.aggregations (concat type "_slugs.buckets")) ~}}
        {{#if key ~}}
          {{> term_checkbox slug=key field=../type selected=(getProperty @root.request.params.query ../type) instance_id=../../instance_id value=(lookup (getProperty @root.data.opportunitySupplimentary.types.aggregations (concat ../type ".buckets")) @index)}}
        {{/if ~}}
      {{/each ~}}
    {{/compare ~}}
  {{/compare ~}}
</div>
{{/inline}}

{{#*inline "availability_filter"}}
  <h3 class="mdc-drawer__content-heading cursor-pointer noselect mdc-drawer--occasional-ie11" data-collapse-target="#{{../instance_id}}-availability-collapse" role="button" aria-pressed="false" aria-label="Show {{getProperty @root.context.metaData.termTypeLabels (concat type ".plural")}}" tabindex="0">
      Availability
    <span class="mdc-icon-toggle pull-right">
    <i class="far fa-chevron-{{#if @root.request.params.query.availability}}up{{else}}down{{/if}}" aria-hidden="true"></i>
  </span>
  </h3>
  <div class="mdc-drawer--occasional-ie11" id="{{../instance_id}}-availability-collapse" style="{{#unless @root.request.params.query.availability}}display:none{{/unless}}">
    {{>opportunity_availability_selector type="availability"}}
  </div>
{{/inline}}

{{#*inline "term_checkbox"}}
  <div class="mdc-form-field">
    <div class="mdc-checkbox">
      <input type="checkbox" class="mdc-checkbox__native-control" id="{{instance_id}}_{{field}}_{{slug}}" name="{{#compare field "===" "type"}}{{field}}{{else}}{{field}}[]{{/compare}}" value="{{slug}}"{{#if (contains selected slug)}} checked{{/if}} />
      <div class="mdc-checkbox__background">
        <svg class="mdc-checkbox__checkmark"
        viewBox="0 0 24 24">
        <path class="mdc-checkbox__checkmark-path"
        fill="none"
        stroke="white"
        d="M1.73,12.91 8.1,19.28 22.79,4.59"/></svg>
        <div class="mdc-checkbox__mixedmark"></div>
      </div>
    </div>
    <label for="{{instance_id}}_{{field}}_{{slug}}">
      {{{default value.key value}}}
    </label>
  </div>
{{/inline}}

<div class="mdc-drawer__content">
  <!-- <h2 class="mdc-drawer__content-heading hide-sm mdc-drawer--occasional">Search opportunities</h2> -->

  <form id="opportunity-search-form" action="/{{#compare @root.request.url.pathname "/map"}}map{{else}}search{{/compare}}" method="GET" class="search-form" novalidate>
    <input type="hidden" name="sort" value="{{@root.request.params.query.sort}}" id="{{instance_id}}-sort">
    <div class="h-padding">
      <div class="mdc-layout-grid">
        <div class="mdc-layout-grid__inner">
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone">
            <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-leading-icon" data-mdc-auto-init="MDCTextField" style="z-index:5;">
              <span class="fas fa-map-marker-alt mdc-text-field__icon geo-lookup" tabindex="0" title="Find my location" role="button" style="pointer-events: initial !important;"></span>
              <input type="text" id="{{instance_id}}-location" name="location" class="mdc-text-field__input mdc-text-field--fullwidth search-location" value="{{#ifAll @root.request.params.query.lat @root.request.params.query.lng}}{{@root.request.params.query.location}}{{/ifAll}}" placeholder="" data-lpignore="true" data-location-search='{
                "latSelector": "[name=\"lat\"]",
                "lngSelector": "[name=\"lng\"]",
                "laSelector": "[name=\"la\"]",
                "locationServicesSelector": ".geo-lookup"
              }'>
              <label class="mdc-floating-label" for="{{instance_id}}-location">
                Location
              </label>
              <div class="mdc-line-ripple"></div>
            </div>
          </div>
        </div>
        <div class="mdc-layout-grid__inner">
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-9-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone">
            <div class="">
              Within
            </div>
          </div>
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-8-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone">
            <div class="h-padding">
              <div data-slider data-slider-value-target="#slider-distance-value" data-slider-display-target="#slider-distance-display" class="mdc-slider mdc-slider--discrete" tabindex="0" role="slider" aria-valuemin="5" aria-valuemax="50" data-step="5" name="distance" aria-valuenow="{{default @root.request.params.query.distance 10}}" aria-label="Select distance">
                <div class="mdc-slider__track-container">
                  <div class="mdc-slider__track"></div>
                </div>
                <div class="mdc-slider__thumb-container">
                  <div class="mdc-slider__pin">
                    <span class="mdc-slider__pin-value-marker"></span>
                  </div>
                  <svg class="mdc-slider__thumb" width="21" height="21">
                    <circle cx="10.5" cy="10.5" r="7.875"></circle>
                  </svg>
                  <div class="mdc-slider__focus-ring"></div>
                </div>
              </div>
              <div class="mdc-line-ripple"></div>
            </div>
          </div>
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4-desktop mdc-layout-grid__cell--span-4-tablet mdc-layout-grid__cell--span-4-phone">
            <span id="slider-distance-display">{{default @root.request.params.query.distance 10}}</span> miles
          </div>
          <input type="hidden" name="distance" id="slider-distance-value" value="{{default @root.request.params.query.distance 10}}">
        </div>
      </div>
    </div>
    <input type="hidden" name="lat" value="{{@root.request.params.query.lat}}" id="location-lat" />
    <input type="hidden" name="lng" value="{{@root.request.params.query.lng}}" id="location-lng" />
    <input type="hidden" name="la" value="{{@root.request.params.query.la}}" id="location-la" />

    <!-- <div class="h-padding">
      <strong>Refine by</strong>
    </div> -->

    <div class="h-padding">
      <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-trailing-icon" data-mdc-auto-init="MDCTextField">
        <input type="text" id="{{instance_id}}-keywords" name="keywords" class="mdc-text-field__input mdc-text-field--fullwidth" value="{{@root.request.params.query.keywords}}" data-lpignore="true" autocomplete="off">
        <label class="mdc-floating-label" for="keywords">
          Keywords
        </label>
        <span class="fas fa-search active-search-icon mdc-text-field__icon" role="button" onclick=" $(this).parents('form:first').submit();" style="pointer-events: initial !important; z-index: 500;" tabindex="-1"></span></a>
        <div class="mdc-line-ripple"></div>
      </div>
    </div>

    {{#each (split "types,work_types,client_groups,services,age_groups" ",") ~}}
      {{> term_filter type=this instance_id=instance_id ~}}
    {{/each ~}}

    {{> availability_filter instance_id=instance_id ~}}

    <div class="h-margin mdc-drawer--occasional-ie11">
      <button class="mdc-button mdc-button--raised mdc-button--large mdc-button--fullwidth mdc-ripple-surface mdc-ripple-surface--primary" type="submit" id="{{instance_id}}-search-submit" data-mdc-auto-init="MDCRipple">
        Search
        <span class="fas fa-search fa-fw" aria-hidden="true"></span>
      </button>
    </div>
  </form>
</div>
